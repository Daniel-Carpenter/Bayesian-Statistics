---
title:    "Lab 4 - Bayes Box and R"
subtitle: "Bayesian Statistics"
author:   "Daniel Carpenter"
date:     "February 2022"
fontsize: 12pt
geometry: margin=1in
output:
  html_document:
    toc: yes
    toc_float: yes
  pdf_document: 
    toc: TRUE
    number_sections: TRUE
  github_document: default
  md_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---

# Task `1`: 

## `a.` Classical Point Estimate for ùúÉ
```{r 1a, echo=TRUE, message=FALSE}
# Probability of success given N number of trials
from = 0
to   = 1
n    = 10

theta <- seq(from, to, length = n)

# Point Estimate for Theta
pointEst <- mean(theta)
pointEst
```

## `b.` Confidence Interval using ùúÉ

`i.` Find classical 95% confidence interval using $\theta$
```{r 1bi, echo=TRUE, message=FALSE}
classicalEst <- pointEst + c(-1, 1) * 1.95 * sqrt(pointEst*(1 - pointEst) / n)
classicalEst
```


`ii.` Interpretation of the Interval above
```{r 1bii, echo=TRUE, message=FALSE}
print(paste0("We can be 95% confident that the true value of theta will be between ",
             round(classicalEst[1], 4), " and ", round(classicalEst[2], 4), 
             " (rounded to 4 decimal places) if repreated samples were taken."))
```

`iii.` How many sample are used to make the interval?
```{r 1biii, echo=TRUE, message=FALSE}
print(paste0("There are ", n, " number of samples used to make the interval."))
```

`iv.` How many samples are assumed to give the interpretation?
```{r 1biv, echo=TRUE, message=FALSE}
print(paste0("An infinite number of samples are assumed to give this interpretation"))
```

---

<br>

# Task `2`: 
> Bayesian methods ‚Äì Bayes‚Äô rule. Assume discrete values of ùúÉ and a uniform prior on the values of ùúÉ

## `a.` Suppose we take `theta = seq(0, 1, length = 20)`
```{r 2a, echo=TRUE, message=FALSE}
# Probability of success given N number of trials
from = 0
to   = 1
n    = 20

theta <- seq(from, to, length = n)
```

## `b.` Plot the prior using base R.
```{r 2b, echo=TRUE, message=FALSE}
prior = rep(1/n, n)

priorPlot <- plot(x = theta, y = prior, 
                  main = paste0("Uniform Prior on the Values of Theta | Daniel Carpenter\n n = ", n),
                  type = "b", pch = 19, col = "tomato3")
```

## `c.` Formula for the Likelihood

### Formula
$$
likelihood: p(D|\theta) = \frac{p(\theta|D)}{p(\theta) / \sum_{\theta^*}p(D|\theta^*) \ p(\theta^*)}
$$

### R Calculations
```{r 2c, echo=TRUE, message=FALSE}
# Substitute Dummy Input value for `x`
numSuccesses = round(n / 2)

likelihood  = dbinom(x=numSuccesses, size = n, prob = theta)
```

## `d.` Plot the Likelihood over Discrete Values of ùúÉ
```{r 2d, echo=TRUE, message=FALSE}
likelihoodPlot <- plot(x = theta, y = likelihood, 
                       main = paste0("Likelihood over the Discrete Values of Theta | Daniel Carpenter\n",
                                     "x = ", numSuccesses, ", n = ", n),
                       type = "b", pch = 19, col = "darkseagreen")
```

## `e.` Prior and the Likelihood Plotted Together
```{r 2e, echo=TRUE, message=FALSE}
# Plot the likelihood
plot(x = theta, y = likelihood, 
                     main = paste0("Likelihood and Prior over the Discrete Values of Theta | Daniel Carpenter\n",
                                   "x = ", numSuccesses, ", n = ", n),
     ylab = "Probability",
                     type = "b", pch = 19, col = "darkseagreen")

# Plot the Prior
lines(x = theta, y = prior, type = "b", pch = 19, col = "tomato3")
```

## `f.` Formula and Plot of the Posterior

### Formula for Posterior
$$
posterior: p(\theta|D) = \frac{p(D|\theta) \ p(\theta)}{p(D)}
$$

### Plot of Posterior
```{r 2f, echo=TRUE, message=FALSE}
# Calculate the Prior x the Likelihood
h <-  prior * likelihood

# Get the posterior Distribution
posterior = h / sum(h)

# Plot of only the posterior
plot(x = theta, y = posterior,
     main = paste0("Posterior over the Discrete Values of Theta | Daniel Carpenter\n",
                   "x = ", numSuccesses, ", n = ", n),
     type = "b", pch = 19, col = "steelblue")
```


### Combined Plots
```{r 2f1, echo=TRUE, message=FALSE}
# Plot the Posterior
plot(x = theta, y = posterior, 
                     main = paste0("Prior, Likelihood, Posterior \nover the Discrete Values of Theta | Daniel Carpenter\n",
                                   "x = ", numSuccesses, ", n = ", n),
                     type = "b", pch = 19, col = "steelblue",
     ylab = "Probability")

# Prior
lines(x = theta, y = prior,     type = "b", pch = 19, col = "tomato3")

# Likelihood
lines(x = theta, y = likelihood, type = "b", pch = 19, col = "darkseagreen")

```


---

<br>

# Task `3`: 

## `a.` Matrix in R that will hold the 5 column vectors
```{r 3a, echo=TRUE, message=FALSE}
bayesMatrix <- matrix(data = c(theta, prior, likelihood, h, posterior), 
                      nr = n, nc = 5, byrow = FALSE)
colnames(bayesMatrix) <- c("theta", "prior", "likelihood", "h", "post")

# Print Table
knitr::kable(bayesMatrix)

# Totals for each Column
knitr::kable(colSums(bayesMatrix))
```

## `b.` Rewrite Bayes‚Äô theorem in terms of h = prior * likelihood
$$
p(\theta|D) = \frac{p(D|\theta) \ p(\theta)}{\sum_{\theta^*}p(D|\theta^*) \ p(\theta^*)}  
$$

## `c.` Plot Prior, Likelihood, and Posterior in `ggplot`
```{r 3c, echo=TRUE, message=FALSE}
numThetaVals = 1:n
df <- as.data.frame(cbind(bayesMatrix, numThetaVals))


if(!require(tidyverse)) install.packages(tidyverse)
df <- df %>%
  
  # Select to only the needed data
  select(-h) %>%
  
  # Pivot y axis variables into single column for ggplot-ing
  pivot_longer(cols      = c("prior", "likelihood", "post"),
               values_to = "values",
               names_to  = "statNames")

# Plot it!
basePlot <- ggplot(df,
                   aes(x = numThetaVals,
                       y = values,
                       color = statNames)) +
  # Theme and colors
  theme_minimal() +
  scale_color_manual(values = c('darkseagreen', 'steelblue', "tomato3")) +
  
  # Labels
  labs(title = "Prior, Likelihood, Posterior over the Discrete Values of Theta",
       subtitle = paste0("Daniel Carpenter | x = ", numSuccesses, ", n = ", n),
       x = 'Number of Theta Values', y = 'Probability')
basePlot + geom_point()

```


---

<br>

# Task `4`: 

## `a.`
```{r 4a, echo=TRUE, message=FALSE}
```

## `b.`
```{r 4b, echo=TRUE, message=FALSE}
```


---

<br>

# Task `5`: 

## `a.`
```{r 5a, echo=TRUE, message=FALSE}
```

## `b.`
```{r 5b, echo=TRUE, message=FALSE}
```

